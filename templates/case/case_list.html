{% extends "/common/layout.html" %}
{% block content %}

    <div id="first" style="float: left">
        <ul>
            {% for i in data %}
                <li>
                    <a href="#" f-id="{{ i.id }}" onclick="getSecondContent(this)" class="a-tag-color">   {{ i.name }}   </a>
                </li>
            {% endfor %}
        </ul>
    </div>

    <div id="second" style="float: left;margin-left: 20px">
        <ul>
        </ul>
    </div>


    <div id="third" style="float: left; margin-left: 20px">

    </div>



{#    {% if data %}#}
{##}
{#        {% for item in data %}#}
{##}
{#            <div class="list-group">#}
{#                <a href="{{ '%s?id=%s' | format(buildUrl('/case/addcase'),item.id) }}" class="list-group-item">#}
{#                    <h4 class="list-group-item-heading">{{ item.apiname | safe }}</h4>#}
{#                    <p class="list-group-item-text">{{ item.explain | safe }}</p>#}
{#                </a>#}
{#            </div>#}
{#        {% endfor %}#}
{#    {% endif %}#}
{##}
    <script>
        function getSecondContent(obj) {
            // 先清空二级的ul
            $('#second').children('ul').html('');
            // 清空三级
            $('#third').html('');
            fid = $(obj).attr('f-id');
            $.ajax({
                url: '/case/getSecondContent',
                type: 'post',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify({'system_id':fid}),
                success: function (resp) {
                    // 请求成功后，加载二级模块
                    for (x in resp.data) {
                        $('#second').children('ul').append('<li><a class="a-tag-color" href="#" onclick="getThirdContent(this)" s-id=' + resp.data[x].id + '>' + resp.data[x].name + '</a></li>')
                    }

                }

            })
        }

        function getThirdContent(obj) {

            // 先清空三级的内容
            $('#third').html('');
            sid = $(obj).attr('s-id');
            $.ajax({
                url: '/case/getThirdContent_model',
                type: 'post',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify({'func_id':sid}),
                success: function (resp) {

                    // 请求成功后，加载三级模块
                    for (x in resp.data) {
                        model_id = resp.data[x].model_id
                        model_name = resp.data[x].model_name
                        model_explain = resp.data[x].model_explain
                        case_num = resp.data[x].case_num

                        var content = '<div class="list-group" model_id="' + model_id + '">'
                        content += '<a href="/case/addcase?id=' + model_id + '" class="list-group-item">'
                        content += '<h4 class="list-group-item-heading">' + model_name + '</h4>'
                        content += '<p class="list-group-item-text">' + model_explain + '</p>'
                        content += '<p class="list-group-item-text" id="case_num">下属用例数:<span>'+case_num+'</span></p>'
                        content += '</a>'
                        content += '<a href="#" class="do-delete">删除模板</a>'

                        content += '</div>'
                        $('#third').append(content);
                    }

                }

            })
        }


        // 注册热键,删除功能
        $(document).on('click', '.do-delete', function () {
            var case_num = $(this).parent().children('a').children('p').children('span').text()
            if (case_num == '0') {
                var model_id = $(this).parent().attr('model_id')
                var currentDiv = $(this).parent();

                $.ajax({
                    url: '/case/deletemodel',
                    method: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({'model_id':[model_id]}),
                    success: function (resp) {
                        if (resp.msg == "删除成功") {
                            currentDiv.remove()
                            console.log($(this).parent())
                        }
                        alert(resp.msg);
                    }
                });



            } else {
                alert('模板下有测试用例，不允许删除！！！')
            }




        });





    </script>

{% endblock %}